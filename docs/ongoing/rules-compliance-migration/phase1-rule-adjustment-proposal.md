# フェーズ1: ルール適用方針

## 方針

**ルールの追加変更は極力避け、どうしても必要と判断した場合だけユーザーに提案する方針**とします。

現在のルール（`.cursor/rules/`）は、API中心の設計を前提としていますが、このプロジェクトは**Webアプリケーション**（HTMLビューを返す従来型のRailsアプリ）です。

以下の点でルールと現状に不一致がありますが、**ルールを変更せず、コードをルールに合わせる方針**で進めます：

1. **コントローラーのルーティング**: ルールではDHHルーティングのみを要求
2. **API設計ツール**: ルールではBlueprinterやCommittee Railsの使用を前提
3. **テストフレームワーク**: ルールではRSpecを前提

---

## ルール適用方針（ルール変更なし）

### 1. controllers.mdc の適用方針

#### 現状のルール
```
Controllerには`routes.rb`でresourcesおよびresourceによって宣言できるアクション（index, show, create, update, destroy）のみを定義する（DHHルーティング）
```

#### 適用方針
**ルールは変更せず、現状のカスタムルートを維持します。**

理由:
- 認証や静的ページなどのカスタムルートは、Webアプリケーションでは一般的で必要
- ルールを変更すると、他のプロジェクトへの影響がある可能性
- 現状の実装は動作しており、変更によるリスクを避ける

**注意**: 今後新規に追加するコントローラーアクションは、可能な限りDHHルーティングに準拠することを推奨

---

### 2. general.mdc の適用方針

#### 現状のルール
```
- `app/controllers/`: API エンドポイントの制御
- `app/serializers/`: APIレスポンスのシリアライズ
```

#### 適用方針
**ルールは変更せず、現状のまま適用します。**

- `app/controllers/` は「エンドポイントの制御」として解釈（API/Web両方を含む）
- `app/serializers/` は、APIを提供する際に使用（現時点では未使用だが、将来の拡張に備える）

**API設計セクションについて**:
- 現時点ではAPIを提供していないため、このセクションは適用しない
- 将来APIを追加する際は、ルールに従ってBlueprinterとCommittee Railsを導入

---

### 3. testing.mdc の適用方針

#### 現状のルール
```
## RSpec
- Factory Bot: テストデータ作成
```

#### 適用方針
**ルールは変更せず、RSpecへの移行はオプション（フェーズ6）として扱います。**

理由:
- 現状はMinitestを使用しており、動作している
- RSpecへの移行は大規模な変更となるため、優先度を下げる
- ルールを変更すると、他のプロジェクトへの影響がある可能性

**今後の対応**:
- フェーズ6でRSpecへの移行を検討（オプション）
- 新規テストを追加する際は、現状のMinitestを使用

---

### 4. serializers.mdc の適用方針

#### 現状のルール
```
- SerializerでAPIレスポンスのフォーマットを定義する
```

#### 適用方針
**ルールは変更せず、現時点では適用しない（APIを提供していないため）。**

- 将来APIを追加する際は、ルールに従ってSerializerを実装
- 現時点では、このルールは適用範囲外

---

## そのまま適用するルール

以下のルールは、Webアプリケーションでも適用可能なため、調整不要：

1. **models.mdc** - モデルの実装規約（そのまま適用）
2. **policies.mdc** - Policyの実装規約（そのまま適用）
3. **validators.mdc** - Validatorの実装規約（そのまま適用）
4. **migration.mdc** - マイグレーション規約（そのまま適用）
5. **i18n.mdc** - 多言語対応規約（そのまま適用）
6. **general.mdc** の以下セクション：
   - 責務の分離
   - 命名規則
   - 共通処理の抽出
   - Ruby コーディングスタイル
   - ドキュメンテーションコメント

---

## 実装方針

### 方針: ルールは変更せず、コードをルールに合わせる

- **ルールの追加変更は極力避ける**
- どうしても必要と判断した場合だけユーザーに提案する
- 現状のルールに合わせて、可能な範囲でコードを変更する

### 適用範囲の整理

- **適用する**: モデル、Policy、Validator、マイグレーション、ドキュメンテーションなどのルール
- **適用しない（現時点）**: API関連のルール（APIを提供していないため）
- **オプション**: テストフレームワークの移行（フェーズ6）

---

## ルール適用範囲の整理

### 適用するルール
- ✅ モデルの実装規約
- ✅ Policyの実装規約
- ✅ Validatorの実装規約
- ✅ マイグレーション規約
- ✅ 多言語対応規約
- ✅ ドキュメンテーション（Yard記法）
- ✅ 責務の分離
- ✅ 命名規則

### 現時点では適用しないルール
- ⚠️ API設計（APIを提供していないため）
- ⚠️ Serializer（APIを提供していないため）

### オプションとして扱うルール
- ⚠️ テストフレームワーク（RSpecへの移行はオプション、フェーズ6）

---

## 次のステップ

1. この適用方針を確認
2. **ルールファイルは変更せず**、この方針に従ってフェーズ2以降の作業を進める
3. どうしてもルールの変更が必要と判断した場合のみ、ユーザーに提案する

