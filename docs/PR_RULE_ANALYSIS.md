# PR作成ルールの分析と不明点

## ルールファイル
`.cursor/rules/create-pullrequest.mdc`

## 不明点・確認が必要な点

### 1. PRテンプレートの参照方法 ✅ 解決済み

**ルールの記述**:
```
.github/pull_request_template.md からテンプレート内容を取得すること
```

**解決内容**:
- ルールを更新して `.github/pull_request_template.md` と明記（GitHub標準の場所）
- テンプレートファイルは `.github/pull_request_template.md` に配置済み

---

### 2. PRテンプレートの1行変換方法

**ルールの記述**:
```
{{PRテンプレートを1行に変換}}の部分は PR テンプレートの内容を`\n`で改行表現した 1 行の文字列
```

**不明点**:
- 具体的な変換コマンドやスクリプトが記載されていない
- AIが自動的に変換する想定なのか、手動で変換する必要があるのか不明

**推奨される対応**:
- 変換方法の例を追加する
  ```bash
  # 例: sedコマンドを使用
  sed ':a;N;$!ba;s/\n/\\n/g' .github/pull_request_template.md
  ```
- または、AIが自動的に処理することを明記

---

### 3. PRタイトルの生成方法

**ルールの記述**:
```
PR タイトルおよび PR テンプレートはマージ先との差分をもとに適切な内容にする
```

**不明点**:
- 「適切な内容」の基準が不明確
- タイトルの形式（例: `[Feature]`, `[Fix]` などのプレフィックス）の有無
- コミットメッセージの規約との関係

**推奨される対応**:
- タイトルの形式や命名規則を明記する
- 例: `[カテゴリ] 簡潔な説明 (#Issue番号)`

---

### 4. Issue番号の扱い

**ルールの記述**:
```
Issue のリンクが提供されていない場合は、必ずユーザーに「関連する Issue のリンクはありますか？」と確認する
Issue が存在しない場合は、その旨を PR の説明に明記する
```

**確認点**:
- Issueがない場合のPR作成可否（禁止なのか、許可なのか）
- Issue番号の記載形式（`Closes #123` など）

**推奨される対応**:
- Issueがない場合の扱いを明確化
- Issue番号の記載形式を統一

---

### 5. マージ先ブランチの指定方法

**ルールの記述**:
```
{{マージ先ブランチ}}は特に指示がなければ main とする
```

**確認点**:
- ユーザーが明示的に指定した場合の優先順位
- デフォルトブランチが `main` 以外の場合の扱い

**推奨される対応**:
- デフォルトブランチの確認方法を明記
- 例: `git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@'`

---

## このルールを参照すべき箇所

### 1. 移行計画ドキュメント

**場所**: `docs/ongoing/rules-compliance-migration/migration-plan.md`

**追加すべき内容**:
- 各フェーズ完了時のPR作成手順
- PR作成時のチェックリスト

---

### 2. チェックリスト

**場所**: `docs/ongoing/rules-compliance-migration/checklist.md`

**追加すべき内容**:
- 各フェーズ完了時のPR作成チェック項目
- Issue番号の確認
- 差分の確認
- PRテンプレートの記入

---

### 3. プロジェクトのREADME

**場所**: `README.md` または `docs/README.md`

**追加すべき内容**:
- PR作成手順への参照
- コントリビューションガイドラインへのリンク

---

### 4. 開発ワークフロードキュメント（作成推奨）

**場所**: `docs/components/development-workflow.md`（新規作成）

**内容**:
- ブランチ戦略
- PR作成手順
- コードレビューの流れ
- マージの基準

---

## 推奨される改善

### 1. ルールファイルの更新 ✅ 完了

以下の点を明確化しました:

```markdown
#### PR テンプレート
- `.github/pull_request_template.md` からテンプレート内容を取得すること
```

テンプレートを1行に変換する場合は、以下のコマンドを使用:
```bash
sed ':a;N;$!ba;s/\n/\\n/g' .github/pull_request_template.md
```

### 2. PR作成ガイドの作成

`docs/PR_CREATION_GUIDE.md` を作成済み。これを参照するようルールに追記。

### 3. テンプレート変換スクリプトの提供

`scripts/generate-pr-body.sh` などのスクリプトを作成し、テンプレートの変換を自動化。

---

## まとめ

### 不明点の優先度

1. ✅ **解決済み**: PRテンプレートの参照方法（`.github/pull_request_template.md` に統一）
2. 🟡 **中**: PRテンプレートの1行変換方法の具体的手順
3. 🟡 **中**: PRタイトルの生成基準
4. 🟢 **低**: Issue番号の扱い（ルール内で説明されているが、より明確化可能）

### 次のステップ

1. ルールファイルの不明点を明確化
2. PR作成ガイドを充実させる
3. 移行計画やチェックリストにPR作成手順を追加
4. 必要に応じてスクリプトやツールを提供

